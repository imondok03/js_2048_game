function t(t){return t&&t.__esModule?t.default:t}var e={};class s{static gameStatus={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=s.gameStatus.idle,this.score=0,this.initialState=t,this.state=t.map(t=>[...t])}getState(){return this.state}getScore(){return this.score}getStatus(){return this.status}moveLeft(){if(this.getStatus()!==s.gameStatus.playing)return;let t=!1,e=this.state.map(e=>{let s=e.filter(t=>0!==t),a=[];for(let e=0;e<s.length;e++)if(s[e]===s[e+1]){let i=2*s[e];a.push(i),this.score+=i,e++,t=!0}else a.push(s[e]);for(;a.length<e.length;)a.push(0);return t||e.every((t,e)=>t===a[e])||(t=!0),a});return t&&(this.state=e,this.addCell(),this.setState(),this.checkStatus()),t}moveRight(){if(this.getStatus()!==s.gameStatus.playing)return;let t=!1,e=this.state.map(e=>{let s=e.filter(t=>0!==t),a=[];for(let e=s.length-1;e>=0;e--)if(s[e]===s[e-1]){let i=2*s[e];a.unshift(i),this.score+=i,e--,t=!0}else a.unshift(s[e]);for(;a.length<e.length;)a.unshift(0);return t||e.every((t,e)=>t===a[e])||(t=!0),a});return t&&(this.state=e,this.addCell(),this.setState(),this.checkStatus()),t}moveUp(){if(this.getStatus()!==s.gameStatus.playing)return;let t=!1,e=this.state.map(t=>[...t]);for(let s=0;s<this.state[0].length;s++){let a=[];for(let t=0;t<this.state.length;t++)0!==this.state[t][s]&&a.push(this.state[t][s]);let i=[];for(let e=0;e<a.length;e++)if(a[e]===a[e+1]){let s=2*a[e];i.push(s),this.score+=s,e++,t=!0}else i.push(a[e]);for(;i.length<this.state.length;)i.push(0);for(let a=0;a<this.state.length;a++)e[a][s]!==i[a]&&(e[a][s]=i[a],t=!0)}return t&&(this.state=e,this.addCell(),this.setState(),this.checkStatus()),t}moveDown(){if(this.getStatus()!==s.gameStatus.playing)return;let t=!1,e=this.state.map(t=>[...t]);for(let s=0;s<this.state[0].length;s++){let a=[];for(let t=this.state.length-1;t>=0;t--)0!==this.state[t][s]&&a.push(this.state[t][s]);let i=[];for(let e=0;e<a.length;e++)if(a[e]===a[e+1]){let s=2*a[e];i.unshift(s),this.score+=s,e++,t=!0}else i.unshift(a[e]);for(;i.length<this.state.length;)i.unshift(0);for(let a=0;a<this.state.length;a++)e[a][s]!==i[a]&&(e[a][s]=i[a],t=!0)}return t&&(this.state=e,this.addCell(),this.setState(),this.checkStatus()),t}start(){this.status=s.gameStatus.playing,this.state=this.initialState.map(t=>[...t]),this.addCell(),this.addCell(),this.setState()}restart(){this.score=0,this.status=s.gameStatus.idle,this.state=this.initialState.map(t=>[...t]),this.setState()}addCell(){let t=[];for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[e].length;s++)0===this.state[e][s]&&t.push({r:e,c:s});if(0===t.length)return;let e=this.addRandomNumber(t.length),{r:s,c:a}=t[e],i=this.state.map(t=>[...t]);i[s][a]=this.getRandomCell(),this.state=i}setState(){let t=document.querySelectorAll(".field-cell"),e=this.state.flat();if(0!==t.length)for(let s=0;s<e.length;s++){let a=t[s],i=e[s];a&&(a.className="field-cell",i>0?(a.textContent=i,a.classList.add(`field-cell--${i}`)):a.textContent="")}}addRandomNumber(t){return Math.floor(Math.random()*t)}getRandomCell(){return .9>Math.random()?2:4}checkStatus(){let t=!1,e=!1,a=this.state.length;for(let t=0;t<a;t++)if(this.state[t].includes(2048)){this.status=s.gameStatus.win;return}for(let s=0;s<a;s++){for(let i=0;i<a&&(0===this.state[s][i]&&(t=!0),i<a-1&&this.state[s][i]===this.state[s][i+1]&&(e=!0),s<a-1&&this.state[s][i]===this.state[s+1][i]&&(e=!0),!t&&!e);i++);if(t||e)break}t||e||(this.status=s.gameStatus.lose)}}const a=new(t(e=s)),i=document.querySelector(".start"),l=document.querySelector(".message-start"),h=document.querySelector(".message-lose"),r=document.querySelectorAll(".message-win"),n=document.querySelector(".game-score");function o(){n.textContent=a.getScore()}i.addEventListener("click",()=>{i.classList.contains("start")?(a.start(),i.classList="button restart",i.innerHTML="Restart",l.classList.add("hidden"),h.classList.add("hidden"),r.classList.add("hidden"),o()):i.classList.contains("restart")&&(a.restart(),i.classList="button start",i.innerHTML="Start",l.classList.remove("hidden"),h.classList.add("hidden"),r.classList.add("hidden"),o())}),document.addEventListener("keydown",s=>{switch(s.key){case"ArrowUp":case"w":a.moveUp();break;case"ArrowDown":case"s":a.moveDown();break;case"ArrowLeft":case"a":a.moveLeft();break;case"ArrowRight":case"d":a.moveRight()}o(),a.getStatus()===t(e).gameStatus.lose?h.classList.remove("hidden"):a.getStatus()===t(e).gameStatus.win&&r.classList.remove("hidden")});
//# sourceMappingURL=index.f4bd77fc.js.map
